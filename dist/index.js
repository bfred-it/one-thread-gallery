(function(){'use strict';function c(da,ea,fa){return ea in da?Object.defineProperty(da,ea,{value:fa,enumerable:!0,configurable:!0,writable:!0}):da[ea]=fa,da}function d(da,ea){ea.appendChild(da)}function e(da,ea,fa){ea.insertBefore(da,fa)}function f(da){da.parentNode.removeChild(da)}function g(da,ea){for(;da.nextSibling&&da.nextSibling!==ea;)da.parentNode.removeChild(da.nextSibling)}function h(da,ea,fa){for(var ga=fa;ga<da.length;ga+=1)da[ga].destroy(ea)}function j(da){return document.createElement(da)}function l(da){return document.createTextNode(da)}function n(){return document.createComment('')}function o(da,ea,fa){da.addEventListener(ea,fa,!1)}function q(da,ea,fa){da.removeEventListener(ea,fa,!1)}function t(da){for(var fa,ea=1;ea<arguments.length;ea+=1)for(var ga in fa=arguments[ea],fa)da[ga]=fa[ga];return da}function u(da,ea){return da!==ea||da&&'object'==typeof da||'function'==typeof da}function w(da,ea,fa,ga){for(var ha in ea)if(ha in fa){var ia=fa[ha],ja=ga[ha];if(u(ia,ja)){var ka=ea[ha];if(!ka)continue;for(var ma,la=0;la<ka.length;la+=1)ma=ka[la],ma.__calling||(ma.__calling=!0,ma.call(da,ia,ja),ma.__calling=!1)}}}function E(da,ea,fa,ga){(ga||'state'in ea&&u(da.state,fa.state)||'media'in ea&&u(da.media,fa.media)||'id'in ea&&u(da.id,fa.id)||'input'in ea&&u(da.input,fa.input))&&(da.status=ea.status=aa.computed.status(da.state,da.media,da.id,da.input))}function F(da,ea){function fa(sa){ea.handleSubmit(sa)}function ga(){ha=!0,ea._set({input:ra.value}),ha=!1}for(var ha=!1,ia=n(),ja=da.status&&G(da,ea),ka=l('\n'),la=n(),ma=da.media,na=[],oa=0;oa<ma.length;oa+=1)na[oa]=H(da,ma,ma[oa],oa,ea);var pa=l('\n'),qa=j('form');qa.action='.',qa.method='get',o(qa,'submit',fa);var ra=j('input');return d(ra,qa),ra.type='text',ra.name='url',ra.autocomplete='off',ra.placeholder='Paste a Reddit post URL',o(ra,'input',ga),ra.value=da.input,{mount:function(sa,ta){e(ia,sa,ta),ja&&ja.mount(sa,ia),e(ka,sa,ta),e(la,sa,ta);for(var ua=0;ua<na.length;ua+=1)na[ua].mount(sa,la);e(pa,sa,ta),e(qa,sa,ta)},update:function(sa,ta){ta.status?ja?ja.update(sa,ta):(ja=G(ta,ea),ja.mount(ia.parentNode,ia)):ja&&(ja.destroy(!0),ja=null);var ua=ta.media;if('media'in sa){for(var va=0;va<ua.length;va+=1)na[va]?na[va].update(sa,ta,ua,ua[va],va):(na[va]=H(ta,ua,ua[va],va,ea),na[va].mount(la.parentNode,la));h(na,!0,ua.length),na.length=ua.length}ha||(ra.value=ta.input)},destroy:function(sa){ja&&ja.destroy(sa),h(na,sa,0),q(qa,'submit',fa),q(ra,'input',ga),sa&&(f(ia),f(ka),f(la),f(pa),f(qa))}}}function G(da){var fa=j('p'),ga=j('noscript');d(ga,fa);var ha=j('noscript');d(ha,fa);var ia=da.status;return ga.insertAdjacentHTML('afterend',ia),{mount:function(ja,ka){e(fa,ja,ka)},update:function(ja,ka){ia!==(ia=ka.status)&&(g(ga,ha),ga.insertAdjacentHTML('afterend',ia))},destroy:function(ja){ja&&(g(ga,ha),f(fa))}}}function H(da,ea,fa,ga,ha){function ia(oa,pa,qa){return qa.isVideo?I:J}var ja,ka=j('a');ka.href=ja=fa.comment,ka.target='_blank';var la=n();d(la,ka);var ma=ia(da,ea,fa,ga),na=ma&&ma(da,ea,fa,ga,ha);return na&&na.mount(ka,la),{mount:function(oa,pa){e(ka,oa,pa)},update:function(oa,pa,qa,ra,sa){ja!==(ja=ra.comment)&&(ka.href=ja),ma===(ma=ia(pa,qa,ra,sa))&&na?na.update(oa,pa,qa,ra,sa):(na&&na.destroy(!0),na=ma&&ma(pa,qa,ra,sa,ha),na&&na.mount(la.parentNode,la))},destroy:function(oa){na&&na.destroy(!1),oa&&f(ka)}}}function I(da,ea,fa){var ia,ja=j('video');return ja.src=ia=fa.media,ja.autoplay=!0,ja.controls=!0,ja.loop=!0,ja.muted=!0,{mount:function(ka,la){e(ja,ka,la)},update:function(ka,la,ma,na){ia!==(ia=na.media)&&(ja.src=ia)},destroy:function(ka){ka&&f(ja)}}}function J(da,ea,fa){var ia,ja=j('img');return ja.src=ia=fa.media,ja.alt='',{mount:function(ka,la){e(ja,ka,la)},update:function(ka,la,ma,na){ia!==(ia=na.media)&&(ja.src=ia)},destroy:function(ka){ka&&f(ja)}}}function K(da){da=da||{},this._state=t(aa.data(),da.data),E(this._state,this._state,{},!0),this._observers={pre:Object.create(null),post:Object.create(null)},this._handlers=Object.create(null),this._root=da._root,this._yield=da._yield,this._torndown=!1,this._fragment=F(this._state,this),da.target&&this._fragment.mount(da.target,null)}function L(da){console.info('Raw JSON',da);const ea=da[0].data.children[0].data.id,fa=$(da,'*.data.children.*.data');for(const ga of fa){const ha=N(ga.body||ga.url).filter(P);for(const ia of new Set(ha))R(ia).then((ja)=>ja.map((ka)=>M({isVideo:ka.endsWith('.gifv'),comment:`https://www.reddit.com/comments/${ea}/_/${ga.id}`,media:Q(ka)})))}}function M(da){const ea=ba.get('media');ea.push(da),ba.set({media:ea})}function N(da){return O(da,ca).map((ea)=>ea[0])}function O(da,ea){const fa=[];for(let ga;ga=ea.exec(da);)fa.push(ga);return fa}function P(da){const ea=/imgur.com|redd.it|gfycat.com/.test(da);return console.log('URL found:',da,ea?'\u2705':'\u274C'),ea}function Q(da){return /gfycat/.test(da)?da.replace(/https?:\/\/gfycat/,'https://giant.gfycat')+'.gif':(da=da.replace(/https?:\/\/([im].)?imgur/,'https://i.imgur'),da=/\/[^.]+$/.test(da)?da+'.jpg':da,da=da.replace(/\.gifv$/,'.mp4'),da)}function R(da){const[,,ea]=da.match(/\/(a|gallery)\/([^.]+)/)||[];return ea?fetch(`https://api.imgur.com/3/album/${ea}/images`,{headers:new Headers(JSON.parse(atob('eyJBdXRob3JpemF0aW9uIjoiQ2xpZW50LUlEIDFhY2M4ZDFiMjk4YzZiYyJ9'))),mode:'cors'}).then((fa)=>fa.json()).then((fa)=>fa.data.map((ga)=>ga.link)).catch(()=>null):Promise.resolve([da])}function S(da){return fetch(`https://www.reddit.com/comments/${da}.json`,{mode:'cors'}).then((ea)=>ea.json())}var T=function(da){var ea=typeof da;return null!==da&&('object'==ea||'function'==ea)},U={dot:/^\./,prop:/[^[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,escape:/\\(\\)?/g},V=function(ea,fa){if(ea)if(Array.isArray(ea))for(var ga=0;ga<ea.length&&!1!==fa(ea[ga],ga);ga++);else if(T(ea))for(var ha=Object.keys(ea),ia=0;ia<ha.length&&!1!==fa(ea[ha[ia]],ha[ia]);ia++);},W=function(ea){var fa=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'.',ga=(''+ea).split(fa),ha=[],ia=null;return ga.forEach(function(ja){if(/^.*\\$/.test(ja))ia=ja;else{if(null==ia)return ha.push(ja);ha.push(ia.slice(0,ia.length-1)+fa+ja),ia=null}}),ha},X=function(ea,fa){return!('*'!==fa)||(0<=fa-parseFloat(fa,10)+1?ea==fa:ea===fa)},Y=function(ea){var fa=[];return W(ea).forEach(function(ga){ga.replace(U.prop,function(ha,ia,ja,ka){fa.push(ja?ka.replace(U.escape,'$1'):ia||ha)})}),fa},$=function(ea,fa){var ga=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!fa||'string'!=typeof fa)return ga;var ha='__set_item__',ia=Y(fa),ja=ia.length,ka=!1,la=0,ma=c({},ha,[ea]);if(ia.forEach(function(oa){var pa=[];V(ma[ha],function(qa){V(qa,function(ra,sa){X(sa,oa)&&('*'===oa&&(ka=!0),pa.push(ra))})}),0<pa.length&&(ma=c({},ha,pa),la++)}),la!==ja)return ga;var na=ma[ha];return ka?na:na.shift()},aa=function(){return{data(){return{title:'One-thread Gallery for Reddit',url:'',input:'',media:[],state:'',id:''}},computed:{status(da,ea,fa,ga){return'done'===da?`Showing ${1===ea.length?'one image':ea.length+' images'} for post <a href="https://redd.it/${fa}" target="_blank">${fa}</a>`:'error'===da?`Loading of post ${fa} failed`:'loading'===da?`Loading post ${fa}...`:'input-error'===da?`The post ID was not recognized: ${ga}`:''}},methods:{handleSubmit(da){da.preventDefault(),this.set({url:this.get('input')})}}}}();t(K.prototype,aa.methods,{get:function(da){return da?this._state[da]:this._state},fire:function(da,ea){var fa=da in this._handlers&&this._handlers[da].slice();if(fa)for(var ga=0;ga<fa.length;ga+=1)fa[ga].call(this,ea)},observe:function(da,ea,fa){var ga=fa&&fa.defer?this._observers.post:this._observers.pre;return(ga[da]||(ga[da]=[])).push(ea),fa&&!1===fa.init||(ea.__calling=!0,ea.call(this,this._state[da]),ea.__calling=!1),{cancel:function(){var ha=ga[da].indexOf(ea);~ha&&ga[da].splice(ha,1)}}},on:function(da,ea){if('teardown'===da)return this.on('destroy',ea);var fa=this._handlers[da]||(this._handlers[da]=[]);return fa.push(ea),{cancel:function(){var ga=fa.indexOf(ea);~ga&&fa.splice(ga,1)}}},set:function(da){this._set(t({},da)),(this._root||this)._flush()},_flush:function(){if(this._renderHooks)for(;this._renderHooks.length;){var da=this._renderHooks.pop();da.fn.call(da.context)}}}),K.prototype._set=function(ea){var fa=this._state;this._state=t({},fa,ea),E(this._state,ea,fa,!1),w(this,this._observers.pre,ea,fa),this._fragment&&this._fragment.update(ea,this._state),w(this,this._observers.post,ea,fa)},K.prototype.teardown=K.prototype.destroy=function(ea){this.fire('destroy'),this._fragment.destroy(!1!==ea),this._fragment=null,this._state={},this._torndown=!0};const ba=new K({target:document.querySelector('main'),data:{url:new URL(location).searchParams.get('url')}});ba.observe('url',(da)=>{if(da){ba.set({media:[]});const[,ea,fa]=da.match(/comments\/(\w+)|^(\w+)$/)||[],ga=ea||fa;return ga?void(ba.set({id:ga}),ba.set({state:'loading'}),history.replaceState(history.state,document.title,`/?url=${ga}`),S(ga).then(L).then(()=>ba.set({state:`done`}),()=>ba.set({state:`error`}))):void ba.set({state:`input-error`})}});const ca=/(https?|ftp):\/\/[^\s/$.?#].[^\s\])]*/gi})();

